#!/usr/bin/env bash

# Ask for the administrator password upfront
sudo -v

###############################################################################
# PHP & Apache                                                                #
###############################################################################

# Install PHP 5.6
curl -s http://php-osx.liip.ch/install.sh | bash -s 5.6

ini=/usr/local/php5/php.d/99-liip-developer.ini
github=https://github.com/mourawaldson

# Backup ini
sudo cp $ini $ini-bkp

# Change timezone
sudo sed -i '' 's/Zurich/Recife/g' $ini
sudo sed -i '' 's/Europe/America/g' $ini
sudo sed -i '' '15 s/^/; /g' $ini
sudo sed -i '' '16 s/^/; /g' $ini

# Enable extensions
for i in {54..79}
do
  command="sudo sed -i '' '$i s/; //g' $ini"
  eval="$command"
done

###############################################################################
# Apps                                                                        #
###############################################################################

# Google Chrome
curl -O https://dl.google.com/chrome/mac/stable/GGRO/googlechrome.dmg && hdiutil attach googlechrome.dmg && cp /Volumes/Google\ Chrome/Google\ Chrome.app /Applications/ && hdiutil detach /Volumes/Google\ Chrome && rm googlechrome.dmg

# CCleaner
curl -k -o ccleaner.dmg https://download.piriform.com/mac/CCMacSetup109.dmg && hdiutil attach ccleaner.dmg && cp -R /Volumes/CCleaner/CCleaner.app /Applications/ && hdiutil detach /Volumes/CCleaner && rm CCMacSetup109.dmg

# Transmission
curl -O https://transmission.cachefly.net/Transmission-2.84.dmg && hdiutil attach Transmission-2.84.dmg && cp -R /Volumes/Transmission/Transmission.app /Applications/ && hdiutil detach /Volumes/Transmission && rm Transmission-2.84.dmg

# VLC
curl -O http://mirror.csclub.uwaterloo.ca/vlc/vlc/2.2.0/macosx/vlc-2.2.0.dmg && hdiutil attach vlc-2.2.0.dmg && cp -R /Volumes/vlc-2.2.0/VLC.app /Applications/ && hdiutil detach /Volumes/vlc-2.2.0 && rm vlc-2.2.0.dmg

# DiffMerge
curl -o DiffMerge.dmg http://download-us.sourcegear.com/DiffMerge/4.2.0/DiffMerge.4.2.0.697.intel.stable.dmg && hdiutil attach DiffMerge.dmg && cp -R /Volumes/DiffMerge\ 4.2.0.697\ intel\ stable/DiffMerge.app /Applications/ && hdiutil detach /Volumes/DiffMerge\ 4.2.0.697\ intel\ stable && rm DiffMerge.dmg

# Atom
# Need to separate header and build a curl post
#curl -o atom https://atom.io/download/mac && url=$(grep -o "http.*\%3D" atom) && download=$(echo curl -o $url) && eval $download

# MacKeeper
curl -o MacKeeper.2.17.1.pkg http://download.mackeeper.com/package.php?bundleId=29_2 && open MacKeeper.2.17.1.pkg

# Dropbox
#https://www.dropbox.com/download?full=1&plat=mac

# GitHub
#https://central.github.com/mac/latest

# GitX
curl -O http://builds.phere.net/GitX/development/GitX-dev.dmg && hdiutil attach GitX-dev.dmg && cp -R /Volumes/GitX\ 1964/GitX.app /Applications/ && hdiutil detach /Volumes/GitX\ 1964 && rm GitX-dev.dmg

###############################################################################
# Misc                                                                        #
###############################################################################

# Install command line
xcode-select --install

# Install .dotfiles
cd $HOME;
curl -sL $github/dotfiles/tarball/master | tar -xzv --strip-components 1 --exclude=readme.md
cd; bash .dotfiles/.osx
